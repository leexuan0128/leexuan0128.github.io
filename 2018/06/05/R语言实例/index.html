<!DOCTYPE html>
<html class="full-height">
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="//cdn.bootcss.com/bulma/0.4.1/css/bulma.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  
  <title>R语言实例 | xuan&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="R语言实例之数据分析 什么是R语言R语言是用于统计分析、绘图的语言和操作环境。R是属于GNU系统的一个自由、免费、开源的软件，它是一个用于统计计算和统计制图的优秀工具。 R语言是主要用于统计分析、绘图的语言和操作环境。 R本来是由来自新西兰奥克兰大学的Ross Ihaka和Robert Gentleman 开发。 （也因此称为R）现在由“R开发核心团队”负责开发。 R是基于S语言的一个GNU项目，">
<meta name="keywords" content="R">
<meta property="og:type" content="article">
<meta property="og:title" content="R语言实例">
<meta property="og:url" content="http://yoursite.com/2018/06/05/R语言实例/index.html">
<meta property="og:site_name" content="xuan&#39;s blog">
<meta property="og:description" content="R语言实例之数据分析 什么是R语言R语言是用于统计分析、绘图的语言和操作环境。R是属于GNU系统的一个自由、免费、开源的软件，它是一个用于统计计算和统计制图的优秀工具。 R语言是主要用于统计分析、绘图的语言和操作环境。 R本来是由来自新西兰奥克兰大学的Ross Ihaka和Robert Gentleman 开发。 （也因此称为R）现在由“R开发核心团队”负责开发。 R是基于S语言的一个GNU项目，">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tKfTcgy1fs08gpfrg1j30r00f70u2.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tKfTcly1fs094zb47fj30cw0aw0tn.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tKfTcly1fs096q9c59j30fe0b6gly.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tKfTcly1fs096ig35gj30fe0bw3zm.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tKfTcly1fs0a6xehsgj308k0d13yu.jpg">
<meta property="og:image" content="https://ws1.sinaimg.cn/large/006tKfTcly1fs096bb64hj31720pot94.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tKfTcly1fs0963jo9xj30wc0jc3yj.jpg">
<meta property="og:image" content="https://ws2.sinaimg.cn/large/006tKfTcly1fs095vv9usj30w20jdweq.jpg">
<meta property="og:image" content="https://ws4.sinaimg.cn/large/006tKfTcly1fs095hpmpcj30w10j774x.jpg">
<meta property="og:updated_time" content="2018-06-05T07:04:37.674Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="R语言实例">
<meta name="twitter:description" content="R语言实例之数据分析 什么是R语言R语言是用于统计分析、绘图的语言和操作环境。R是属于GNU系统的一个自由、免费、开源的软件，它是一个用于统计计算和统计制图的优秀工具。 R语言是主要用于统计分析、绘图的语言和操作环境。 R本来是由来自新西兰奥克兰大学的Ross Ihaka和Robert Gentleman 开发。 （也因此称为R）现在由“R开发核心团队”负责开发。 R是基于S语言的一个GNU项目，">
<meta name="twitter:image" content="https://ws4.sinaimg.cn/large/006tKfTcgy1fs08gpfrg1j30r00f70u2.jpg">
  
    <link rel="alternate" href="/atom.xml" title="xuan&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/common.css">
<link rel="stylesheet" href="/css/nav.css">
<link rel="stylesheet" href="/css/layout.css">
  

</head>

<body>
  <header id="navbar" class="overflow-hidden">
  <div class="container">
    <nav class="nav">
         <div class="nav-left">
            <a href="/" class="nav-item" style="font-size: 20px;">
              <span class="logo">Xuan</span>'s Blog
            </a>
         </div>
        <div class="nav-center is-hidden position-relative" id="search_container">
            <div class="nav-item full-width full-height">
                <i class="fa fa-search has-padding" aria-hidden="true"></i>
                <input type="text" id="search_input" class="search-input full-height full-width" placeholder="Search post" autofocus>
                <i id="close_search" class="fa fa-times" aria-hidden="true"></i>
            </div>
            <div id="search_result"></div>
        </div>
        <div class="nav-right nav-menu">
            <a class="nav-item" id="search">
                <i class="fa fa-search" aria-hidden="true"></i>
            </a>
            
            <a class="nav-item" href="/">
                Home
            </a>
            
            <a class="nav-item" href="/about">
                About
            </a>
            
        </div>
        <span class="nav-toggle" id="navMenuDropdown">
            <span></span>
            <span></span>
            <span></span>
        </span>
        <div class="navbar-menu position-absolute full-width content-box is-hidden-desktop is-flex flex-column center" style="top: 100%;">
            
            <a class="nav-item flex-1" href="/">
                Home
            </a>
            
            <a class="nav-item flex-1" href="/about">
                About
            </a>
            
        </div>
    </nav>
  </div>
</header>

  <div id="main-wrap" class="position-relative" style="margin-top: 55px;">
      <div class="main-inner-content">
          <!--博文页面-->

<style>
    .header-box {
        height: 370px;
        filter: blur(10px);
        background-size: cover;
        background-color: lightsteelblue;
    }

    .post-box {
        padding: 15px;
        padding-top: 60px;
        min-height: 80vh;
        margin-top: -200px;
        border-radius: 4px;
        background-color: rgba(255,255,255,.8);
    }

    .post-avatar {
        height: 30px;
        width: 30px;
        border-radius: 50%;
    }

    .flow-chart {
        text-align: center;
    }

    img[alt="post-cover"] {
        display: none;
    }
</style>
<header>
    <div id="header_box" class="header-box"></div>
</header>
<section>
    <div class="container post-box">
        <div class="content post-title is-flex center flex-column" style="margin-bottom: 70px; overflow: auto;">
            <h1 class="has-text-centered" style="padding-bottom: 10px; border-bottom: 3px solid #fff">
                <strong>R语言实例</strong>
            </h1>
            
            <div class="is-flex align-center">
                <img class="post-avatar" src="https://avatars3.githubusercontent.com/u/29593367?v=4&u=52694e53ae74066be5677eacf887392b208d9262&s=400">
                <span style="padding:0 10px;"> <span class="sub-title">By</span> Xuan</span>
                <span class="post-date sub-title">at: 2018-06-05</span>
            </div>
            
                <div>
                    
                         <a class="tag is-post-tag" href="/tags/R/">R</a>
                    
                </div>
            
        </div>
        <div class="content" style="overflow: auto">
            <h1 id="R语言实例之数据分析"><a href="#R语言实例之数据分析" class="headerlink" title="R语言实例之数据分析"></a>R语言实例之数据分析</h1><p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fs08gpfrg1j30r00f70u2.jpg" alt=""></p>
<h2 id="什么是R语言"><a href="#什么是R语言" class="headerlink" title="什么是R语言"></a>什么是R语言</h2><p>R语言是用于统计分析、绘图的语言和操作环境。R是属于GNU系统的一个自由、免费、开源的软件，它是一个用于统计计算和统计制图的优秀工具。 R语言是主要用于统计分析、绘图的语言和操作环境。 R本来是由来自新西兰奥克兰大学的Ross Ihaka和Robert Gentleman 开发。 （也因此称为R）现在由“R开发核心团队”负责开发。 R是基于S语言的一个GNU项目，所以也可以当作S语言的一种实现，通常用S语言编写的代码都可以不作修改的在R环境下运行。 R的语法是来自Scheme。</p>
<h2 id="R语言能做什么"><a href="#R语言能做什么" class="headerlink" title="R语言能做什么"></a>R语言能做什么</h2><ul>
<li>R是科学计算的强大工具包。</li>
<li>R主要擅长统计分析方面工作。</li>
<li>R具有顶尖的绘图功能。</li>
<li>R的交互式数据分析功能强大且灵活。</li>
<li>R可以轻松地从多个数据源导入数据。</li>
<li>金融领域数据统计与计算的强大工具。</li>
<li>数据挖掘和机器学习领域的必备工具。<h2 id="为什么要用R语言"><a href="#为什么要用R语言" class="headerlink" title="为什么要用R语言"></a>为什么要用R语言</h2>R语言，前身是S语言，是一门统计学家发明的语言，所以事实上其天生善于完成统计运算，内置了太多统计相关函数，现在每时每刻都产生大量数据，从数据中抽取出信息，所以人们比以往任何时候更依赖于统计（因为….数据太多，根本看不多来，正确的统计分析至少可以简化）。当然，可视化也是重点，对数据涵盖的信息进行可视化。</li>
</ul>
<p>R语言，其实存在不少人包括我，觉得他其实并不太像一门编程语言。但是这并没有所谓，我个人认可的有偏颇的观点是：一门编程语言的流行，要么其设计优秀，要么具有稳定而活跃的社区。设计优秀与社区活跃可以是相辅相成，但事实上只要有活跃的社区，设计是否优秀可能暂时并没那么重要。</p>
<p>R语言，就是一个庞大的帝国，他其实是一个全家桶，封装了各种，也调用了各种，包括了Java，C，C++等等。对R语言的基本使用，其实就是用所谓的R包 （R package）。每一个R包的作者会把有用或者自己觉得有用的函数更或者对象封装起来，最后，对于我们使用者而言，就只要下载安装R包，然后准备数据和输入函数，得到结果。这一个R语言的使用逻辑简单到几乎所有人都会用，也非常适合完全没有计算机基础的研究工作者。</p>
<hr>
<blockquote>
<p>R语言以及集成开发环境RStudio的安装在此就不再赘述，各大博客，简书和知乎已经写的非常详细。直接进入今天的主题：R内置数据集USArrest的量化分析及可视化。</p>
</blockquote>
<h2 id="任务需求"><a href="#任务需求" class="headerlink" title="任务需求"></a>任务需求</h2><p>调用R内置数据集USArrests，该数据集包含1973年美国50个州的每10万人中谋杀、被捕、强奸犯罪的人数以及城市人口的增长率。根据数据集进行以下分析：</p>
<ol>
<li>绘出城市人口增长的线性图；</li>
<li>绘出谋杀和强奸人数占总被捕人数的条形图；</li>
<li>哪些州犯罪情况比较接近，相对适宜居住的州是哪些?(使用聚类分析)。</li>
</ol>
<p>R内置数据集USArrests中包含4个对象，分别是”Murder” ，”Assault”，”UrbanPop”和”Rape”。</p>
<p>将数据集赋值给a<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#调用数据集</div><div class="line">a &lt;- USArrests</div></pre></td></tr></table></figure></p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcly1fs094zb47fj30cw0aw0tn.jpg" alt=""></p>
<p><strong>问题1</strong> 要求绘制出城市人口增长的线性图，即不同城市与UrbanPop数据的线性对应关系。</p>
<h2 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h2><p>我们可利用R中的初级绘图函数plot(x, y, …)，进行初步的数据点绘制。再利用plot()函数中的type参数，实现点与点之间的连线。选用type= “o “来进行点与点之间的连接。形成线形图。具体操作如下：</p>
<p>首先，查看一下plot函数的功能，plot()函数是R语言中初级绘图函数，其用法如下为：</p>
<blockquote>
<p>plot(x, y, …)</p>
</blockquote>
<p>参数说明：</p>
<ul>
<li>main:标题</li>
<li>xlab,ylab:x,y轴说明</li>
<li>xlim,ylim:x,y轴的刻度界限</li>
<li>col:描点的颜色</li>
<li>pch:描点的样式，19代号为实心圆点，也可以换成其他代号。</li>
<li>type:绘图形中数据的显示类型,</li>
</ul>
<p>type参数:</p>
<ul>
<li>type= “p “ 在图形中数据显示为点</li>
<li>type= “l “  在图形中数据显示为线</li>
<li>type= “b “ 在图形中数据显示为点和连接线</li>
<li>type= “o “ 在图形中数据点覆盖在线上</li>
<li>type= “h “ 在图形中数据显示为从点到x轴的垂直线</li>
<li>type= “s “ 在图形中数据显示为阶梯图</li>
<li>type= “n “ 在图形中数据不显示</li>
</ul>
<p>首先，我们绘出基本的数据点图:设置颜色col、横纵坐标轴名称、主标题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#绘图</div><div class="line">plot(USArrests$UrbanPop,col = &quot;blue&quot;,xlab = &quot;city&quot;,ylab = &quot;UrbanPop Rate(%)&quot;,</div><div class="line">main = &quot;plot of urban population growth&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fs096q9c59j30fe0b6gly.jpg" alt=""><br>接着对数据点连接成线,加入type= “o “，以及pch=19两个参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">plot(USArrests$UrbanPop,col = &quot;blue&quot;,type = &quot;o&quot;,xaxt=&quot;n&quot;,pch = 19,</div><div class="line">     xlab = &quot;city&quot;,ylab = &quot;UrbanPop Rate(%)&quot;,main = &quot;plot of urban population growth&quot;)</div></pre></td></tr></table></figure></p>
<p>横坐标的数据点代表50个不同城市的人口增长率，所以考虑将横坐标名称替换成城市名字，这样更加符合要求，方便观看。这里需要用到一个axis()函数，来对坐标轴元素进行更改。首先我们在plot()函数中设置参数xaxt=”n”，取消原图x轴坐标。接着我们将数据集中的<code>row.names</code>对象赋值给<code>state.name</code>，代表城市名称，方便后续调用。</p>
<p>axis()函数用法为：<br><code>axis(side = NULL, at = NULL, ..., side, labels = NULL)</code></p>
<p>side为一个整数，用于指定图形中坐标轴的绘制方向。坐标轴按如下方式绘制：1下，2左，3上，4右。labels可以是一个逻辑值，表示是否要在刻度线上进行注释， 或要放在刻度线上作标签的一个字符或表达式向量。at参数需要提供相同长度向量范围，即x轴坐标范围。代码为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#调用数据集城市名称</div><div class="line">state.name = row.names(a)</div><div class="line">#定义x坐标轴</div><div class="line">axis(side = 1,at = 1:50,labels = state.name,las = 2)</div></pre></td></tr></table></figure></p>
<p>最终显示效果为：<br><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fs096ig35gj30fe0bw3zm.jpg" alt=""><br>问题1解决，仅仅用了4行代码就解决了问题，R语言实现起来是不是很方便呢。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#调用数据集</div><div class="line">a &lt;- USArrests</div><div class="line">#绘图</div><div class="line">plot(USArrests$UrbanPop,col = &quot;blue&quot;,type = &quot;o&quot;,xaxt=&quot;n&quot;,pch = 19,</div><div class="line">     xlab = &quot;city&quot;,ylab = &quot;UrbanPop Rate(%)&quot;,main = &quot;plot of urban population growth&quot;)</div><div class="line">#调用数据集城市名称</div><div class="line">state.name = row.names(a)</div><div class="line">#定义x坐标轴</div><div class="line">axis(side = 1,at = 1:50,labels = state.name,las = 2)</div></pre></td></tr></table></figure></p>
<p><strong>问题2</strong>要求绘出谋杀和强奸人数占总被捕人数的条形图。</p>
<h2 id="设计思路-1"><a href="#设计思路-1" class="headerlink" title="设计思路"></a>设计思路</h2><p>使用ggplot2包中<code>ggplot()</code>函数来绘制条形图较为方便。</p>
<p>首先，我们需要构造出data.frame类型的mydata数据集，其中包含谋杀、强奸、以及总被捕人数三个对象。总被捕人数为谋杀、强奸、袭击人数之和。创建对象d：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 被捕人数数据集</div><div class="line">d = USArrests[c(&apos;Murder&apos;,&apos;Rape&apos;,&apos;Assault&apos;)]</div></pre></td></tr></table></figure></p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fs0a6xehsgj308k0d13yu.jpg" alt=""><br>构造mydata对象：其中包含150条数据，3个对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#总被捕的人数</div><div class="line">b = a$Murder+a$Rape+a$Assault</div><div class="line">#创建data.frame型mydata</div><div class="line">city &lt;- state.name</div><div class="line">size &lt;- c(a$Murder,a$Rape,b)</div><div class="line">type &lt;- rep(c(&quot;Murder&quot;,&quot;Rape&quot;,&quot;Total&quot;),each=50)</div><div class="line">mydata &lt;- data.frame(type,city,size)</div></pre></td></tr></table></figure></p>
<p>接着使用ggplot()函数进行绘图，将谋杀、强奸、总被捕人数显示在一张柱形图中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># 加载ggplot2</div><div class="line">library(ggplot2)</div><div class="line">#绘图</div><div class="line">ggplot(mydata,aes(x=city,y=size,fill=type))+</div><div class="line">  geom_bar(stat = &quot;identity&quot;,position=&quot;dodge&quot;)+</div><div class="line">  theme(axis.text.x = element_text(angle=90, hjust=1, vjust=.5))+</div><div class="line">  ggtitle(&quot;Murder and Rape Ratio&quot;)+</div><div class="line">  labs(subtitle = &apos;1973,Murder and rape account for the total number of arrests&apos;)+</div><div class="line">  geom_text(aes(label = size), vjust = -0.3,hjust = 0.6, colour = &quot;black&quot;, position = position_dodge(0.9), size = 2)</div></pre></td></tr></table></figure></p>
<p><code>aes()</code>函数中的fill参数设置为type，表示按type数据集中的对象进行分类填充,即Murder、Rape、Total。<br><code>geom_bar()</code>函数中的position参数为”dodge”，表示三个对象排列显示。<br><code>theme()</code>函数用来显示坐标轴信息，图中我们选择90度逆时针选择城市名称。<br><code>geom_text()</code>函数用来在条形图上标注数据，vjust和hjust用来调整数据位置。<code>position_dodge()</code>用来调整数据的大小<br><code>coord_flip()</code>用来旋转x y坐标轴<br>所绘图型为：<br><img src="https://ws1.sinaimg.cn/large/006tKfTcly1fs096bb64hj31720pot94.jpg" alt=""><br>代码实现如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">#总被捕的人数</div><div class="line">b = a$Murder+a$Rape+a$Assault</div><div class="line">#创建data.frame型mydata</div><div class="line">city &lt;- state.name</div><div class="line">size &lt;- c(a$Murder,a$Rape,b)</div><div class="line">type &lt;- rep(c(&quot;Murder&quot;,&quot;Rape&quot;,&quot;Total&quot;),each=50)</div><div class="line">mydata &lt;- data.frame(type,city,size)</div><div class="line"># 加载ggplot2</div><div class="line">library(ggplot2)</div><div class="line">#绘图</div><div class="line">ggplot(mydata,aes(x=city,y=size,fill=type))+</div><div class="line">  geom_bar(stat = &quot;identity&quot;,position=&quot;dodge&quot;)+</div><div class="line">  theme(axis.text.x = element_text(angle=90, hjust=1, vjust=.5))+</div><div class="line">  ggtitle(&quot;Murder and Rape Ratio&quot;)+</div><div class="line">  labs(subtitle = &apos;1973,Murder and rape account for the total number of arrests&apos;)+</div><div class="line">  geom_text(aes(label = size), vjust = -0.3,hjust = 0.6, colour = &quot;black&quot;, position = position_dodge(0.9), size = 2)</div></pre></td></tr></table></figure></p>
<p><strong>问题2</strong>主要是需要构造data.frame数据类型，接着对绘图函数中<code>fill</code>参数进行设置，用我们设置好的<code>Murder、Rape、Total</code>来进行填充,来显示三组数据。</p>
<p><strong>问题3</strong>要求我们使用聚类分析，来查看哪些州犯罪情况比较接近，得出相对适宜居住的州是哪些?</p>
<hr>
<h2 id="回顾一下聚类分析的知识点"><a href="#回顾一下聚类分析的知识点" class="headerlink" title="回顾一下聚类分析的知识点"></a>回顾一下聚类分析的知识点</h2><h3 id="聚类分析"><a href="#聚类分析" class="headerlink" title="聚类分析"></a>聚类分析</h3><p>聚类分析是统计中另一个非常重要的方法，可以帮助我们在多维度的数据中把相似的数据归为子集，每个子集中的数据都具有某种程度的相似性。在具体的生物研究中，聚类可以帮助我们通过表达类似的基因找到功能相关的基因，或者帮助推测未知基因的功能。通常聚类分析也被称作非监督机器学习。</p>
<p>进行聚类分析首先需要计算不同观测值之间的距离,进而生成聚类使用的距离矩阵。<br>计算距离的方法有很多，选择不同的距离计算方法也会对最终的聚类结果产生很大的影响。常用的距离计算方法有欧氏距离(Euclidean distance)、曼哈顿距离(Manhattan distance)和基于相关性距离(correlation-based distances)的Pearson correlation distances、Spearman’s rank correlation、Kendall correlation distance 等等。</p>
<p>另外，在构建距离矩阵之前，往往会对原始的观测数据进行标准化，如计算z score。</p>
<p>总的来说，聚类方法从整体上主要使用的有Partitioning method 和Hierarchical Clustering 两类，其中Partitioning 包括K-means clustering，K-medoids clustering(PAM)等具体方法。</p>
<h3 id="K-means"><a href="#K-means" class="headerlink" title="K-means"></a>K-means</h3><p>k-means<br>在k-means算法中，首先我们需要确定数据最终分为几类(k)，然后会根据分类数量随机选取k个点最为每个类的初始质心（这也是同一组数据每次聚类的结果都不尽相同的原因），随后其他的点都会通过欧式距离找到分到和自己最近的初始中心。通过一次这样的过程之后，再根据每个集合中的点计算均值得到新的质心，重复之前的过程进行迭代。每次迭代，每个集合中的质心都会重新产生，所有的非质心点再重新分配给新的质心形成集合。如果在一次迭代中，只有非常少的点会发生集合的转移则迭代停止。</p>
<p>需要注意的是，k-means聚类的方法对异常值非常敏感，与之相比PAM要好一些。</p>
<p>在R中，kmeans聚类可以使用stats包中的kmeans()函数，如果想使用K-medoids clustering 可以借助cluster包中的pam()函数。另外，在进行cluster和pca相关的分析中，factoextra 也是一个不错的选择，包括了各种常用的功能。</p>
<p>一个比较完整的k-means聚类分析过程主要包括数据标准化，评估合适cluster数数目，进行计算以及可视化展示等步骤。</p>
<h3 id="Hierarchical-Clustering"><a href="#Hierarchical-Clustering" class="headerlink" title="Hierarchical Clustering"></a>Hierarchical Clustering</h3><p>层次聚类和k-means相比不需要预先设定聚类的数目，最终的聚类结果会以颠倒树状结构显示，不同类别观测值在树的最底层（树叶），越向上节点越少。层次聚类可以细分为Agglomerative Clustering 和 Divisive Hierarchical，前者的思路是从“树叶”向“树干”聚集，后者的思路是从“树干”向“树叶”分裂。一般而言，Agglomerative Clustering 适合在clusters比较少时使用；而Divisive Hierarchical 适合在有大量clusters 时使用，可以选择到那一步停下不再细分。</p>
<p>以Agglomerative Clustering 为例，大致流程是首先将每个对象归为一类，每类仅包含一个对象，计算类与类之间的距离。找到最近的两个类然后合并, 接着计算新类与所有旧类之间的距离。重复之前的过程，直到最后合并成一个类为止。</p>
<p>根据类间距离计算方法的不同，又可以分为五种: single-linkage(类和类两组对象间的最小距离)、 complete-linkage(类和类两组对象间的最大距离)、 average-linkage(两组对象间的平均距离)、centroid linkage 和Ward′s method(在每一步使组内离差平方和增量最小)。</p>
<p>一个比较完整的层次聚类分析过程主要包括数据标准化，计算距离，构建聚类树，确定分组以及可视化展示等步骤。</p>
<p>在R中，计算距离时可以使用dist()函数，构建聚类树可以使用hclust()函数，将树分组可以使用cutree()。当然也可以使用cluster包同时完成上面几个步骤。</p>
<hr>
<h2 id="设计思路-2"><a href="#设计思路-2" class="headerlink" title="设计思路"></a>设计思路</h2><ul>
<li>构建标准化数据集</li>
<li>构建聚类树</li>
<li>使用k-means聚类所需的包<code>(factoextra),(dendextend)</code></li>
<li>对图形做进一步的美化</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#标准化数据集usa_norm</div><div class="line">usa_norm &lt;- dist(scale(USArrests), method = &quot;euclidean&quot;)</div><div class="line"># 构建聚类树hc</div><div class="line">hc &lt;- hclust(usa_norm, method = &quot;complete&quot;)</div><div class="line"># 可视化展示</div><div class="line">install.packages(c(&quot;factoextra&quot;, &quot;dendextend&quot;))</div><div class="line">library(factoextra)</div><div class="line">#绘图</div><div class="line">plot(hc, hang = -1, cex = 0.8)</div></pre></td></tr></table></figure>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fs0963jo9xj30wc0jc3yj.jpg" alt=""><br>先绘出基本的聚类树图，将参数hang设置为-1，表示将x坐标城市名逆时针90度显示，方便观看。<br>接着进行聚类分组：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#美化</div><div class="line">fviz_dend(hc, k = 4,      # 聚类分为4类</div><div class="line">          cex = 1,      # label大小，显示字体</div><div class="line">          k_colors = c(&quot;#2E9FDF&quot;, &quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;),</div><div class="line">          color_labels_by_k = TRUE,  # 分组颜色标签</div><div class="line">          rect = TRUE, # 在周围添加矩形组</div><div class="line">          rect_fill = TRUE,</div><div class="line">          rect_border = c(&quot;#2E9FDF&quot;, &quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;),</div><div class="line">          ggtheme = theme_void() # ggplot2的主题</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>得到绘图：<br><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fs095vv9usj30w20jdweq.jpg" alt=""><br>也可以改变显示方式为环形显示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 环形显示结果</div><div class="line">fviz_dend(hc, cex = 1, k = 4,k_colors = &quot;jco&quot;, type = &quot;circular&quot;)</div></pre></td></tr></table></figure></p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcly1fs095hpmpcj30w10j774x.jpg" alt=""><br>代码实现：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#标准化数据集usa_norm</div><div class="line">usa_norm &lt;- dist(scale(USArrests), method = &quot;euclidean&quot;)</div><div class="line"># 构建树hc</div><div class="line">hc &lt;- hclust(usa_norm, method = &quot;complete&quot;)</div><div class="line"># 可视化展示</div><div class="line">install.packages(c(&quot;factoextra&quot;, &quot;dendextend&quot;))</div><div class="line">library(factoextra)</div><div class="line">#绘图</div><div class="line">plot(hc, hang = -1, cex = 0.8)</div><div class="line">#美化</div><div class="line">fviz_dend(hc, k = 4,      # 聚类分为4类</div><div class="line">          cex = 1,      # label大小，显示字体</div><div class="line">          k_colors = c(&quot;#2E9FDF&quot;, &quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;),</div><div class="line">          color_labels_by_k = TRUE,  # 分组颜色标签</div><div class="line">          rect = TRUE, # 在周围添加矩形组</div><div class="line">          rect_fill = TRUE,</div><div class="line">          rect_border = c(&quot;#2E9FDF&quot;, &quot;#00AFBB&quot;, &quot;#E7B800&quot;, &quot;#FC4E07&quot;),</div><div class="line">          ggtheme = theme_void() # ggplot2的主题</div><div class="line">)</div><div class="line"># 环形显示结果</div><div class="line">fviz_dend(hc, cex = 1, k = 4,k_colors = &quot;jco&quot;, type = &quot;circular&quot;)</div></pre></td></tr></table></figure></p>
<blockquote>
<p>通过这次实践，摆脱了单纯的理论知识学习状态，从安装环境到代码实现，整个过程的实践性很强，锻炼了解决实际问题的能力，同时也提高了我查阅参考资料，文档书写的水平。提高是有限的，但提高也是全面的。今后，我会加强Python和R的学习，扎实掌握这门技能，对于数据挖掘和数据分析的知识还需进一步摸索和学习。</p>
</blockquote>
<p>作者：leexuan<br>2018年06月05日</p>

        </div>
        <div class="post-reply">
            
                <!-- 来必力City版安装代码 -->
                <div id="lv-container" data-id="city" data-uid="MTAyMC8yOTE4Ni81NzUz">
                    <script type="text/javascript">
                        (function(d, s) {
                            var j, e = d.getElementsByTagName(s)[0];

                            if (typeof LivereTower === 'function') { return; }

                            j = d.createElement(s);
                            j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                            j.async = true;

                            e.parentNode.insertBefore(j, e);
                        })(document, 'script');
                    </script>
                    <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
                </div>
                <!-- City版安装代码已完成 -->
            
            
        </div>
    </div>
</section>
<script>
    // 获取第一张图, 用以当封面背景图
    var img = document.querySelectorAll('img')[1]

    if (img) {
        var header_box = document.querySelector('#header_box')
        header_box.style.backgroundImage = 'url('+ img.src +')'
    }
</script>
      </div>
  </div>
  <style>
  #footer {
    min-height: 10vh;
    background: black;
    color: #fff;
  }

  #footer a {
    color: #e1e1e1;
  }
</style>
<footer id="footer" class="has-text-centered is-flex center">
  <div class="container has-padding">
    <div>
      <div>
        <!--请您保留作者署名, 主题制作来之不易-->
        Theme by <a href="http://haojen.github.io/">Haojen Ma</a>
        <br>
        Copyright © xuan 2018
        <br>
        Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
      </div>
    </div>
  </div>
</footer>

<script src="/js/search_core.js"></script>
<script src="/js/script.js"></script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>